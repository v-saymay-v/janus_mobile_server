(function(m,p,c,q){var d=false;var i=false;var e=true;function b(s){var r=s||"";return r.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(r){return p.getElementById(r)}function h(s,r){return r?r.getElementsByClassName(s):p.getElementsByClassName(s)}function o(y,u,x,s,r){var t=y||"GET";var w=new XMLHttpRequest();w.onreadystatechange=function(){if(w.readyState===4){w.onreadystatechange=null;if(w.status>=200&&w.status<300){var A=w.responseText;try{A=JSON.parse(A)}catch(z){}s&&s(A)}else{r&&r(w.responseText)}}};w.open(t,u,true);if(x){for(var v in x){w.setRequestHeader(v,x[v])}}w.send(null)}function j(r){return new Error("PBX ERROR: "+r)}function g(t,s,w,r,v){var x=function(y,z){o("POST",t,null,y,function(){z&&z();throw j("Failed to get token!")})};var u=function(z,y,D){var E=z||{};var C=E.access_token;if(!C){D&&D();throw j("Failed to get token!")}if(!s){D&&D();throw j("Invalid domain!")}var A={Authorization:"Bearer "+C,lang:w};for(var B in E){if(/^x([-_])zm\1.+/i.test(B)){A[B]=E[B]}}o("",s,A,function(F){y(F)},function(){D&&D();throw j("Failed to get menu!")})};x(function(y){u(y,r,v)},v)}function n(s){if(s){var t=null;var r=function(){var u=p.createElement("span");u.style.cssText="margin-left:6px;line-height:16px;float:left;width:16px;height:16px;text-algin:center;display:none";u.innerHTML="<span class='zm-icon-loading'></span>";return u};return{start:function(){if(!t){t=r();s.appendChild(t)}t.style.display="block"},stop:function(){if(!t){return}t.style.display="none"}}}return{start:function(){},stop:function(){}}}function k(r,y){var w=[];for(var t=0;t<y.length;t++){var v=y[t];var u="nav-item"+(r===t?" active":"");var s=v.attrs;var x=v.text;w.push(['<li role="none" class="'+u+'">','<a role="menuitem" aria-describedby="current-page-describedby" '+s+">"+x+"</a>","</li>"].join(""))}return w}function f(w,y,A){var s=h("nav-list",y)[0];if(!s){return}var C=location.pathname.replace(/\/$/g,"");var t=[];var E=-1;for(var x=0;x<w.length;x++){var u=w[x].jsonText;var D=w[x].text;if(u){try{var B=JSON.parse(u);var v={href:"",text:"",attrs:""};v.href=B.href||"";v.text=b(D||B.text||"");if(E<0&&v.href.replace(/[?#].*/g,"").replace(/\/$/g,"")===C){E=x}for(var r in B){if(r!=="text"){v.attrs+=(v.attrs?" ":"")+(r+(B[r]!==""?('="'+B[r]+'"'):""))}}if(v.attrs){v.attrs=b(v.attrs)}t.push(v);console.log("menu",t)}catch(z){console.log(j("Invalid menu format!"))}}}if(t.length>0){s.innerHTML=k(E,t).join("");if(E>-1||e){A.click()}e=true}}function a(u,v){if(u.IsAccountSetupPBX===true&&(u&&u.PbxVersionSwitch&&u.PbxVersionSwitch.pbx_1_6_0)){var y=v.lang||"";var t=u.tokenURL||("/pbx/web/getToken?"+(new Date()).getTime());var s=u.Domain?(u.Domain+"/api/"+u.APIVer+"/pbx/web/menu"):"";var w=l("pbx_column_container");if(!w){return}var x=w?h("nav-header",w)[0]:null;if(!x){return}var r=n(x);x.addEventListener("click",function(){if(d||i){return}d=true;r.start();g(t,s,y,function(z){r.stop();d=false;i=true;f(z,w,x)},function(){d=false;r.stop()})},false)}m.triggerPBXMenu=function(){if(u.IsAccountSetupPBX===true&&(u&&u.PbxVersionSwitch&&u.PbxVersionSwitch.pbx_1_6_0)){var z=l("pbx_column_container");if(!z){return}var A=z?h("nav-header",z)[0]:null;if(!A){return}A.click();e=false}}}if(!m.bootStrapPBXMenu){m.bootStrapPBXMenu=a}})(window,document,window.PBXConfig,window.i18nJson);